<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tally Prime to SQL Server: Enterprise Architecture</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <!-- 
    Enterprise Data Integration Architecture Guide
    Based on Technical Note: "The Imperative for Centralized Financial Intelligence"
    
    Key Updates:
    1. Added "The Paradox" section (Object vs Relational).
    2. ODBC Section: Added detailed schema mapping tables.
    3. XML Section: Highlighted TDL Injection as the "Killer Feature".
    4. Audit Section: Added Edit Log / Version History extraction strategy.
    5. Design: Clean, sidebar-driven technical documentation layout.
    -->
    <style>
        body { font-family: 'Inter', system-ui, -apple-system, sans-serif; }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap');
        
        h1, h2, h3, h4 { letter-spacing: -0.025em; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        
        /* Syntax Highlighting for XML/SQL */
        .code-bg { background-color: #0f172a; color: #e2e8f0; }
        .token-tag { color: #7dd3fc; } /* light blue */
        .token-attr { color: #c4b5fd; } /* violet */
        .token-val { color: #86efac; } /* green */
        .token-comment { color: #64748b; font-style: italic; }
        .token-keyword { color: #f472b6; } /* pink */

        /* Smooth Scroll behavior */
        html { scroll-behavior: smooth; }
        
        /* Sidebar active state */
        .nav-link.active { background-color: #1e293b; color: #60a5fa; border-right: 3px solid #60a5fa; }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        slate: { 850: '#1e293b', 900: '#0f172a' },
                        tally: { gold: '#f59e0b', teal: '#14b8a6' }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-slate-50 text-slate-800 antialiased flex flex-col lg:flex-row min-h-screen">

    <!-- Sidebar Navigation -->
    <aside class="w-full lg:w-72 bg-slate-900 text-slate-400 flex-shrink-0 lg:h-screen lg:sticky lg:top-0 overflow-y-auto border-r border-slate-800 z-20">
        <div class="p-6 border-b border-slate-800">
            <div class="flex items-center gap-2 mb-1">
                <i class="fa-solid fa-database text-blue-500"></i>
                <span class="text-lg font-bold text-slate-100 tracking-tight">Data<span class="text-blue-500">Architect</span></span>
            </div>
            <p class="text-xs text-slate-500 uppercase tracking-widest font-semibold">Tally to SQL Pipeline</p>
        </div>
        <nav class="p-4 space-y-1 text-sm font-medium">
            <div class="px-3 py-2 text-xs font-bold text-slate-500 uppercase mt-2">Context</div>
            <a href="#paradox" class="nav-link block px-3 py-2 rounded hover:bg-slate-800 hover:text-slate-200 transition-colors">The Object-Relational Paradox</a>
            <a href="#star-schema" class="nav-link block px-3 py-2 rounded hover:bg-slate-800 hover:text-slate-200 transition-colors">Target Star Schema</a>

            <div class="px-3 py-2 text-xs font-bold text-slate-500 uppercase mt-4">Extraction Methods</div>
            <a href="#odbc" class="nav-link block px-3 py-2 rounded hover:bg-slate-800 hover:text-slate-200 transition-colors">Method A: ODBC (The Basics)</a>
            <a href="#xml-api" class="nav-link block px-3 py-2 rounded hover:bg-slate-800 hover:text-slate-200 transition-colors">Method B: XML & TDL Injection</a>
            
            <div class="px-3 py-2 text-xs font-bold text-slate-500 uppercase mt-4">Compliance & Strategy</div>
            <a href="#audit-log" class="nav-link block px-3 py-2 rounded hover:bg-slate-800 hover:text-slate-200 transition-colors text-amber-500"><i class="fa-solid fa-shield-halved mr-1"></i> Audit Trail (Edit Log)</a>
            <a href="#etl-strategy" class="nav-link block px-3 py-2 rounded hover:bg-slate-800 hover:text-slate-200 transition-colors">ETL Lifecycle & Incremental</a>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 min-w-0 overflow-y-auto">
        <!-- Header -->
        <header class="bg-white border-b border-slate-200 px-8 py-6 sticky top-0 z-10 bg-opacity-95 backdrop-blur">
            <h1 class="text-2xl font-bold text-slate-900">Enterprise Data Integration Architecture</h1>
            <p class="text-slate-500 mt-1">Migrating from Tally's OODBMS to Microsoft SQL Server for Centralized Intelligence</p>
        </header>

        <div class="max-w-5xl mx-auto px-8 py-12 space-y-20">

            <!-- Section 1: The Paradox -->
            <section id="paradox" class="scroll-mt-32">
                <div class="flex items-center gap-3 mb-6">
                    <span class="bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-xs font-bold uppercase">Architectural Challenge</span>
                    <h2 class="text-3xl font-bold text-slate-900">The Object-Relational Paradox</h2>
                </div>
                <p class="text-lg text-slate-600 mb-8 leading-relaxed">
                    The impedance mismatch between Tally's hierarchical Object-Oriented Database Management System (OODBMS) and SQL Server's relational model is the primary engineering hurdle. Tally data is encapsulated in recursive "Objects" (Collections), whereas SQL requires normalized "Tables".
                </p>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-0 rounded-xl overflow-hidden border border-slate-200 shadow-sm">
                    <!-- Tally Side -->
                    <div class="bg-slate-50 p-8 border-b md:border-b-0 md:border-r border-slate-200">
                        <h3 class="font-bold text-slate-800 mb-4 flex items-center gap-2">
                            <i class="fa-solid fa-layer-group text-orange-500"></i> Tally Object Model (TOM)
                        </h3>
                        <ul class="space-y-3 text-sm text-slate-600">
                            <li class="flex items-start gap-2"><i class="fa-solid fa-check text-slate-400 mt-1"></i> <span><strong>Hierarchical:</strong> Vouchers contain LedgerEntries, which contain BillAllocations.</span></li>
                            <li class="flex items-start gap-2"><i class="fa-solid fa-check text-slate-400 mt-1"></i> <span><strong>Polymorphic:</strong> A Sales Voucher and Payment Voucher share the "Voucher" ID but have completely different fields.</span></li>
                            <li class="flex items-start gap-2"><i class="fa-solid fa-check text-slate-400 mt-1"></i> <span><strong>Methods ($):</strong> Attributes are accessed via methods like <code class="bg-slate-200 px-1 rounded text-xs">$OpeningBalance</code>.</span></li>
                        </ul>
                    </div>
                    <!-- SQL Side -->
                    <div class="bg-white p-8">
                        <h3 class="font-bold text-slate-800 mb-4 flex items-center gap-2">
                            <i class="fa-solid fa-table text-blue-600"></i> SQL Relational Model
                        </h3>
                         <ul class="space-y-3 text-sm text-slate-600">
                            <li class="flex items-start gap-2"><i class="fa-solid fa-check text-slate-400 mt-1"></i> <span><strong>Normalized:</strong> Data must be exploded into Header, Line Items, and Allocations tables.</span></li>
                            <li class="flex items-start gap-2"><i class="fa-solid fa-check text-slate-400 mt-1"></i> <span><strong>Strict Schema:</strong> Columns must be defined (DECIMAL, NVARCHAR) and cannot vary row-by-row.</span></li>
                            <li class="flex items-start gap-2"><i class="fa-solid fa-check text-slate-400 mt-1"></i> <span><strong>Flattened:</strong> Hierarchies must be resolved into Foreign Key relationships.</span></li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Section 2: Method A (ODBC) -->
            <section id="odbc" class="scroll-mt-32 border-t border-slate-100 pt-16">
                <h2 class="text-2xl font-bold text-slate-900 mb-4">Method A: The ODBC Interface</h2>
                <p class="text-slate-600 mb-6">
                    The synchronous pathway. Tally acts as an ODBC Server (Port 9000). Suitable for ad-hoc queries but suffers from the "Cartesian Product" explosion during flattening and blocks the Tally UI.
                </p>

                <div class="bg-white border border-slate-200 rounded-lg overflow-hidden shadow-sm mb-8">
                    <div class="bg-slate-50 px-6 py-3 border-b border-slate-200 flex justify-between items-center">
                        <h3 class="font-bold text-slate-700 text-sm uppercase">Table 1: Standard Ledger Schema</h3>
                        <span class="text-xs text-slate-500">Partial Mapping</span>
                    </div>
                    <table class="min-w-full divide-y divide-slate-200 text-sm">
                        <thead class="bg-white">
                            <tr>
                                <th class="px-6 py-3 text-left font-medium text-slate-500">ODBC Field ($)</th>
                                <th class="px-6 py-3 text-left font-medium text-slate-500">Description</th>
                                <th class="px-6 py-3 text-left font-medium text-slate-500">SQL Target Type</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-slate-200">
                            <tr><td class="px-6 py-3 font-mono text-slate-700">$Name</td><td class="px-6 py-3">Unique Identifier (PK)</td><td class="px-6 py-3 font-mono text-blue-600">NVARCHAR(255)</td></tr>
                            <tr><td class="px-6 py-3 font-mono text-slate-700">$Parent</td><td class="px-6 py-3">Group Hierarchy</td><td class="px-6 py-3 font-mono text-blue-600">NVARCHAR(255)</td></tr>
                            <tr><td class="px-6 py-3 font-mono text-slate-700">$ClosingBalance</td><td class="px-6 py-3">Computed Balance</td><td class="px-6 py-3 font-mono text-blue-600">DECIMAL(18,2)</td></tr>
                            <tr><td class="px-6 py-3 font-mono text-slate-700">$Partygstin</td><td class="px-6 py-3">GST Number</td><td class="px-6 py-3 font-mono text-blue-600">NVARCHAR(20)</td></tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Section 3: XML & TDL Injection -->
            <section id="xml-api" class="scroll-mt-32 border-t border-slate-100 pt-16">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold text-slate-900">Method B: XML API & <span class="text-blue-600">TDL Injection</span></h2>
                    <span class="bg-green-100 text-green-800 text-xs px-3 py-1 rounded-full font-bold uppercase tracking-wide border border-green-200">The Killer Feature</span>
                </div>
                
                <p class="text-slate-600 mb-6">
                    The superior methodology for Data Warehousing. Unlike ODBC, it allows <strong class="text-slate-900">TDL Injection</strong>—the ability to send temporary TDL definitions inside the request payload. This enables a "Zero Footprint" extraction (no TCP files needed on client machines) and creates custom, optimized collections on the fly.
                </p>

                <!-- Code Example -->
                <div class="bg-slate-900 rounded-xl shadow-2xl overflow-hidden my-8">
                    <div class="bg-slate-800 px-4 py-2 flex items-center justify-between border-b border-slate-700">
                        <span class="text-xs text-slate-400 font-mono">POST http://localhost:9000/</span>
                        <span class="text-xs text-slate-500">XML Payload with Injection</span>
                    </div>
                    <div class="p-6 overflow-x-auto">
<pre class="text-sm font-mono leading-6 code-bg">
<span class="token-tag">&lt;ENVELOPE&gt;</span>
    <span class="token-tag">&lt;HEADER&gt;</span><span class="token-tag">&lt;TALLYREQUEST&gt;</span>Export<span class="token-tag">&lt;/TALLYREQUEST&gt;</span><span class="token-tag">&lt;/HEADER&gt;</span>
    <span class="token-tag">&lt;BODY&gt;</span>
        <span class="token-tag">&lt;EXPORTDATA&gt;</span>
            <span class="token-tag">&lt;REQUESTDESC&gt;</span>
                <span class="token-tag">&lt;REPORTNAME&gt;</span>CustomVoucherReport<span class="token-tag">&lt;/REPORTNAME&gt;</span>
                <span class="token-tag">&lt;STATICVARIABLES&gt;</span>
                    <span class="token-tag">&lt;SVEXPORTFORMAT&gt;</span>$$SysName:XML<span class="token-tag">&lt;/SVEXPORTFORMAT&gt;</span>
                <span class="token-tag">&lt;/STATICVARIABLES&gt;</span>
            <span class="token-tag">&lt;/REQUESTDESC&gt;</span>
        <span class="token-tag">&lt;/EXPORTDATA&gt;</span>
        
        <span class="token-comment">&lt;!-- TDL INJECTION: DEFINING A TEMPORARY COLLECTION --&gt;</span>
        <span class="token-tag">&lt;TDL&gt;</span>
            <span class="token-tag">&lt;TDLMESSAGE&gt;</span>
                <span class="token-tag">&lt;REPORT NAME="CustomVoucherReport"&gt;</span>
                    <span class="token-tag">&lt;FORMS&gt;</span>CustomVoucherForm<span class="token-tag">&lt;/FORMS&gt;</span>
                <span class="token-tag">&lt;/REPORT&gt;</span>
                <span class="token-tag">&lt;!-- ... Form and Part definitions skipped for brevity ... --&gt;</span>
                
                <span class="token-tag">&lt;COLLECTION NAME="MySQL_Voucher_Collection"&gt;</span>
                    <span class="token-tag">&lt;TYPE&gt;</span>Voucher<span class="token-tag">&lt;/TYPE&gt;</span>
                    <span class="token-tag">&lt;!-- EAGER LOAD specific fields to optimize performance --&gt;</span>
                    <span class="token-tag">&lt;FETCH&gt;</span>Date, VoucherNumber, Amount, AllLedgerEntries<span class="token-tag">&lt;/FETCH&gt;</span>
                <span class="token-tag">&lt;/COLLECTION&gt;</span>
            <span class="token-tag">&lt;/TDLMESSAGE&gt;</span>
        <span class="token-tag">&lt;/TDL&gt;</span>
    <span class="token-tag">&lt;/BODY&gt;</span>
<span class="token-tag">&lt;/ENVELOPE&gt;</span>
</pre>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-8">
                    <div class="p-4 bg-blue-50 rounded-lg border border-blue-100">
                        <h4 class="font-bold text-blue-800 mb-2 text-sm uppercase">Zero Deployment</h4>
                        <p class="text-xs text-slate-600">No need to restart Tally or copy .tcp files. The extraction logic lives in your python/C# script.</p>
                    </div>
                    <div class="p-4 bg-blue-50 rounded-lg border border-blue-100">
                        <h4 class="font-bold text-blue-800 mb-2 text-sm uppercase">Eager Loading</h4>
                        <p class="text-xs text-slate-600">Using <code class="mono">FETCH</code> prevents lazy-loading, speeding up bulk export by 10-50x.</p>
                    </div>
                    <div class="p-4 bg-purple-50 rounded-lg border border-purple-100">
                        <h4 class="font-bold text-purple-800 mb-2 text-sm uppercase">JSON Support (Rel 4.0)</h4>
                        <p class="text-xs text-slate-600">Newer Tally versions support JSON response formats for easier parsing in Node/Python.</p>
                    </div>
                </div>
            </section>

            <!-- Section 4: Audit Log -->
            <section id="audit-log" class="scroll-mt-32 border-t border-slate-100 pt-16">
                <div class="flex items-center gap-3 mb-6">
                    <i class="fa-solid fa-gavel text-amber-500 text-2xl"></i>
                    <h2 class="text-2xl font-bold text-slate-900">Audit Trail & Compliance (Edit Log)</h2>
                </div>
                <p class="text-slate-600 mb-6">
                    Mandated by the MCA for specific classes of companies. Tally Prime Release 2.1+ tracks the history of all changes. Extraction requires accessing deep version details.
                </p>

                <div class="bg-white rounded-lg border border-slate-200 shadow-sm p-6">
                    <h3 class="font-bold text-slate-800 mb-4">Forensic Fields to Extract</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-y-4 gap-x-8">
                        <div class="flex justify-between border-b border-slate-100 pb-2">
                            <span class="font-mono text-slate-600 text-sm">$CreatedBy</span>
                            <span class="text-slate-500 text-sm">User who made the entry</span>
                        </div>
                        <div class="flex justify-between border-b border-slate-100 pb-2">
                            <span class="font-mono text-slate-600 text-sm">$CreatedDate</span>
                            <span class="text-slate-500 text-sm">Timestamp of creation</span>
                        </div>
                        <div class="flex justify-between border-b border-slate-100 pb-2">
                            <span class="font-mono text-slate-600 text-sm">$AlteredBy</span>
                            <span class="text-slate-500 text-sm">User who last modified</span>
                        </div>
                        <div class="flex justify-between border-b border-slate-100 pb-2">
                            <span class="font-mono text-slate-600 text-sm">$AlteredOn</span>
                            <span class="text-slate-500 text-sm">Timestamp of modification</span>
                        </div>
                         <div class="flex justify-between border-b border-slate-100 pb-2 col-span-full">
                            <span class="font-mono text-slate-600 text-sm">$Action</span>
                            <span class="text-slate-500 text-sm">Type: <span class="text-green-600 font-bold">Create</span>, <span class="text-blue-600 font-bold">Alter</span>, <span class="text-red-600 font-bold">Delete</span></span>
                        </div>
                    </div>
                    
                    <div class="mt-6 bg-amber-50 p-4 rounded border border-amber-100 text-sm text-amber-800">
                        <strong>⚠️ Handling Deletions:</strong> Deleted vouchers disappear from standard reports. You must query the specific "Deleted Vouchers" collection or track "Gaps" in Master IDs in your SQL warehouse to maintain a true audit log.
                    </div>
                </div>
            </section>

            <!-- Section 5: ETL Strategy -->
            <section id="etl-strategy" class="scroll-mt-32 border-t border-slate-100 pt-16 pb-32">
                <h2 class="text-2xl font-bold text-slate-900 mb-6">Target Star Schema & ETL Strategy</h2>
                
                <div class="space-y-8">
                    <!-- Schema Design -->
                    <div class="bg-white p-6 rounded-lg border border-slate-200 shadow-sm">
                        <h3 class="font-bold text-slate-800 mb-4 text-lg">1. Star Schema Design</h3>
                        <p class="text-sm text-slate-600 mb-4">Do not replicate Tally's hierarchy in SQL. Flatten data into Facts and Dimensions.</p>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="border border-slate-200 p-3 rounded bg-slate-50">
                                <div class="font-bold text-blue-700 text-sm mb-1">Fact_Transaction_Lines</div>
                                <div class="text-xs text-slate-500">Granularity: One row per ledger entry. Contains Amount, LedgerKey, VoucherKey.</div>
                            </div>
                            <div class="border border-slate-200 p-3 rounded bg-slate-50">
                                <div class="font-bold text-slate-700 text-sm mb-1">Dim_Ledger</div>
                                <div class="text-xs text-slate-500">Name, Group, GSTIN, State, Parent.</div>
                            </div>
                            <div class="border border-slate-200 p-3 rounded bg-slate-50">
                                <div class="font-bold text-slate-700 text-sm mb-1">Dim_Date</div>
                                <div class="text-xs text-slate-500">Fiscal Year, Quarter, Month.</div>
                            </div>
                        </div>
                    </div>

                    <!-- Incremental Logic -->
                    <div class="bg-white p-6 rounded-lg border border-slate-200 shadow-sm">
                        <h3 class="font-bold text-slate-800 mb-4 text-lg">2. Incremental Load (CDC)</h3>
                        <ol class="list-decimal list-inside space-y-3 text-sm text-slate-700">
                            <li><strong>Initial Load:</strong> Extract all history.</li>
                            <li><strong>Delta Logic:</strong> Query Tally for Vouchers where <code class="bg-slate-100 px-1 rounded">$AlteredOn > Last_SQL_Sync_Time</code>.</li>
                            <li><strong>Upsert:</strong> Check if <code class="mono">$GUID</code> exists in SQL.
                                <ul class="pl-8 list-disc text-slate-500 mt-1">
                                    <li>If exists: <strong>DELETE</strong> old lines, <strong>INSERT</strong> new lines (handles modification).</li>
                                    <li>If new: <strong>INSERT</strong>.</li>
                                </ul>
                            </li>
                            <li><strong>Concurrency:</strong> Queue exports sequentially. Tally is single-threaded.</li>
                        </ol>
                    </div>
                </div>
            </section>

        </div>
    </main>

    <script>
        // Simple ScrollSpy for Sidebar Highlighting
        window.addEventListener('scroll', () => {
            const sections = document.querySelectorAll('section');
            const navLinks = document.querySelectorAll('.nav-link');
            
            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                if (scrollY >= sectionTop - 150) {
                    current = section.getAttribute('id');
                }
            });

            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href').includes(current)) {
                    link.classList.add('active');
                }
            });
        });
    </script>
</body>
</html>
